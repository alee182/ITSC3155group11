{% include 'navbar.html' %}
{% load static %}
{% block content %}
<script src="{% static 'js/message.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/message.css' %}">

<div class="chat-wrapper">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="search-bar">
      <input type="text" id="userSearch" placeholder="Search">
    </div>
    <div class="user-list">
      {% for user in users %}
        <a href="{% url 'message' slug=user.full_name_slug %}" class="user-link">
          <div class="user {% if selected_user and user == selected_user %}active{% endif %}">
            <img src="{% if user.profile_pic %}{{ user.profile_pic.url }}{% else %}{% static 'images/emptyuserprofile.jpg' %}{% endif %}"
                 class="profile-pic" alt="{{ user.get_full_name }}">
            <span class="username">{{ user.get_full_name }}</span>
          </div>
        </a>
      {% endfor %}
    </div>
  </div>

  <!-- Chat Area -->
  <div class="chat-area">
    {% if selected_user %}
    <div class="chat-header">
      <h4>{{ selected_user.get_full_name }}</h4>
    </div>
    <div class="messages">
      {% for msg in messages %}
      <div class="message-row {% if msg.sender == request.user %}you{% else %}them{% endif %}">
        {% if msg.sender != request.user %}
          <div class="profile-info">
            <img src="{% if msg.sender.profile_pic %}{{ msg.sender.profile_pic.url }}{% else %}{% static 'images/emptyuserprofile.jpg' %}{% endif %}"
                 class="profile-pic" alt="{{ msg.sender.get_full_name }}">
            <p class="username">{{ msg.sender.get_full_name }}</p>
          </div>
        {% endif %}
      
        <div class="bubble">
          <p class="msg-content">{{ msg.content }}</p>
          <span class="timestamp">{{ msg.timestamp|date:"M d, Y h:i A" }}</span>
        </div>
      
        {% if msg.sender == request.user %}
          <div class="profile-info">
            <img src="{% if request.user.profile_pic %}{{ request.user.profile_pic.url }}{% else %}{% static 'images/emptyuserprofile.jpg' %}{% endif %}"
                 class="profile-pic" alt="You">
            <p class="username">You</p>
          </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <form method="POST" action="{% url 'message' slug=selected_user.full_name_slug %}" class="chat-input">
      {% csrf_token %}
      <input type="text" name="message" placeholder="Type your message..." required>
      <button type="submit">&#8679;</button>
    </form>
    {% else %}
    <div class="empty-chat">
      <img src="{% static 'images/Normsleep.png' %}" alt="No Chat">
      <p>Norm has no one to talk to</p>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}




